<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Life Bonus</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #1a1a2e;
            color: white;
            padding: 20px;
        }
        .debug-info {
            background: #16213e;
            padding: 20px;
            border-radius: 10px;
            margin: 10px 0;
        }
        button {
            background: #4ECDC4;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #45b7aa;
        }
        .result {
            background: #0f3460;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            border-left: 4px solid #4ECDC4;
        }
    </style>
</head>
<body>
    <h1>üêõ Debug Life Bonus System</h1>
    
    <div class="debug-info">
        <h3>Informa√ß√µes do Usu√°rio</h3>
        <div id="user-info">Carregando...</div>
    </div>
    
    <div class="debug-info">
        <h3>Invent√°rio do Usu√°rio</h3>
        <button onclick="checkInventory()">Verificar Invent√°rio</button>
        <div id="inventory-info"></div>
    </div>
    
    <div class="debug-info">
        <h3>Teste Life Bonus</h3>
        <button onclick="testLifeBonus()">Testar hasUserItemSync('life_bonus')</button>
        <button onclick="addLifeBonusToInventory()">Adicionar Life Bonus ao Invent√°rio</button>
        <div id="test-results"></div>
    </div>
    
    <div class="debug-info">
        <h3>LocalStorage Debug</h3>
        <button onclick="showLocalStorage()">Mostrar LocalStorage</button>
        <button onclick="clearUserItems()">Limpar Itens do Usu√°rio</button>
        <div id="localStorage-info"></div>
    </div>

    <script type="module">
        import RankingManager from './src/classes/RankingManager.js';
        import Shop from './src/classes/ShopClass.js';
        import { NavigationHelper } from './src/navigation.js';

        // Inicializar sistemas
        const rankingManager = new RankingManager();
        const shop = new Shop(rankingManager);
        
        // Configurar usu√°rio atual
        const currentUser = NavigationHelper.getCurrentUser();
        if (currentUser) {
            rankingManager.currentUser = currentUser;
        }

        // Disponibilizar globalmente para os bot√µes
        window.rankingManager = rankingManager;
        window.shop = shop;
        window.currentUser = currentUser;

        // Mostrar informa√ß√µes do usu√°rio
        function updateUserInfo() {
            const userInfoDiv = document.getElementById('user-info');
            if (currentUser) {
                userInfoDiv.innerHTML = `
                    <strong>ID:</strong> ${currentUser.id}<br>
                    <strong>Nome:</strong> ${currentUser.name}<br>
                    <strong>Moedas:</strong> ${currentUser.coins || 0}<br>
                    <strong>Pontua√ß√£o:</strong> ${currentUser.high_score || 0}
                `;
            } else {
                userInfoDiv.innerHTML = '<span style="color: #ff6b6b;">‚ùå Usu√°rio n√£o logado</span>';
            }
        }

        window.checkInventory = async function() {
            const inventoryDiv = document.getElementById('inventory-info');
            inventoryDiv.innerHTML = 'Carregando invent√°rio...';
            
            try {
                const userItems = await shop.getUserItems();
                console.log('Invent√°rio completo:', userItems);
                
                if (userItems.length === 0) {
                    inventoryDiv.innerHTML = '<div class="result">üì¶ Invent√°rio vazio</div>';
                } else {
                    let html = '<div class="result">';
                    userItems.forEach(item => {
                        const shopItem = shop.getItemById(item.item_id);
                        html += `
                            <strong>${shopItem ? shopItem.name : item.item_id}</strong><br>
                            - ID: ${item.item_id}<br>
                            - Permanente: ${item.is_permanent ? 'Sim' : 'N√£o'}<br>
                            - Usos restantes: ${item.uses_remaining || 'N/A'}<br>
                            - Comprado em: ${new Date(item.purchased_at).toLocaleString()}<br><br>
                        `;
                    });
                    html += '</div>';
                    inventoryDiv.innerHTML = html;
                }
            } catch (error) {
                console.error('Erro ao carregar invent√°rio:', error);
                inventoryDiv.innerHTML = `<div class="result" style="border-left-color: #ff6b6b;">‚ùå Erro: ${error.message}</div>`;
            }
        };

        window.testLifeBonus = function() {
            const resultsDiv = document.getElementById('test-results');
            
            try {
                const hasLifeBonus = shop.hasUserItemSync('life_bonus');
                console.log('Resultado hasUserItemSync("life_bonus"):', hasLifeBonus);
                
                resultsDiv.innerHTML = `
                    <div class="result">
                        <strong>hasUserItemSync('life_bonus'):</strong> ${hasLifeBonus ? '‚úÖ TRUE' : '‚ùå FALSE'}
                    </div>
                `;
            } catch (error) {
                console.error('Erro no teste:', error);
                resultsDiv.innerHTML = `<div class="result" style="border-left-color: #ff6b6b;">‚ùå Erro: ${error.message}</div>`;
            }
        };

        window.addLifeBonusToInventory = function() {
            if (!currentUser) {
                alert('Usu√°rio n√£o logado!');
                return;
            }
            
            const userItems = JSON.parse(localStorage.getItem(`userItems_${currentUser.id}`) || '[]');
            
            // Verificar se j√° existe
            const existingItem = userItems.find(item => item.item_id === 'life_bonus');
            if (existingItem) {
                alert('Life Bonus j√° existe no invent√°rio!');
                return;
            }
            
            // Adicionar life_bonus
            const lifeBonusItem = {
                item_id: 'life_bonus',
                item_name: 'Vida B√¥nus',
                item_category: 'utility',
                is_permanent: false,
                uses_remaining: 1,
                purchased_at: new Date().toISOString()
            };
            
            userItems.push(lifeBonusItem);
            localStorage.setItem(`userItems_${currentUser.id}`, JSON.stringify(userItems));
            
            alert('Life Bonus adicionado ao invent√°rio!');
            checkInventory();
        };

        window.showLocalStorage = function() {
            const localStorageDiv = document.getElementById('localStorage-info');
            
            if (!currentUser) {
                localStorageDiv.innerHTML = '<div class="result">‚ùå Usu√°rio n√£o logado</div>';
                return;
            }
            
            const userItemsKey = `userItems_${currentUser.id}`;
            const userItems = localStorage.getItem(userItemsKey);
            
            localStorageDiv.innerHTML = `
                <div class="result">
                    <strong>Chave:</strong> ${userItemsKey}<br>
                    <strong>Dados:</strong><br>
                    <pre style="background: #0a0a0a; padding: 10px; border-radius: 5px; overflow-x: auto;">${userItems || 'null'}</pre>
                </div>
            `;
        };

        window.clearUserItems = function() {
            if (!currentUser) {
                alert('Usu√°rio n√£o logado!');
                return;
            }
            
            if (confirm('Tem certeza que deseja limpar todos os itens do usu√°rio?')) {
                localStorage.removeItem(`userItems_${currentUser.id}`);
                alert('Itens do usu√°rio removidos!');
                checkInventory();
                showLocalStorage();
            }
        };

        // Inicializar
        updateUserInfo();
        checkInventory();
    </script>
</body>
</html>