<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ðŸŽ® Teste: Skins no Jogo</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background: #1a1a1a;
            color: #00ff88;
            padding: 20px;
            margin: 0;
        }
        
        .test-section {
            background: #2a2a2a;
            border: 2px solid #4ECDC4;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .log {
            background: #000;
            border: 1px solid #333;
            border-radius: 5px;
            padding: 10px;
            margin: 10px 0;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
            font-size: 12px;
        }
        
        button {
            background: #4ECDC4;
            color: #1a1a1a;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            margin: 5px;
        }
        
        button:hover {
            background: #45b7aa;
        }
        
        .skin-option {
            display: inline-block;
            margin: 10px;
            padding: 10px;
            background: #333;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            border: 2px solid transparent;
        }
        
        .skin-option:hover {
            border-color: #4ECDC4;
        }
        
        .skin-option.selected {
            border-color: #00ff88;
            background: #2a4a2a;
        }
        
        .skin-option img {
            width: 48px;
            height: 48px;
            object-fit: contain;
            background: rgba(255,255,255,0.1);
            border-radius: 4px;
        }
        
        .game-link {
            display: inline-block;
            background: #ff6b6b;
            color: white;
            padding: 15px 30px;
            text-decoration: none;
            border-radius: 8px;
            font-weight: bold;
            margin: 10px;
        }
        
        .game-link:hover {
            background: #ff5252;
        }
    </style>
</head>
<body>
    <h1>ðŸŽ® Teste: Skins no Jogo</h1>
    
    <div class="test-section">
        <h2>1. Configurar UsuÃ¡rio de Teste</h2>
        <p>Simular um usuÃ¡rio logado com dados completos:</p>
        <button onclick="setupGameUser()">Criar UsuÃ¡rio</button>
        <button onclick="clearGameUser()">Limpar UsuÃ¡rio</button>
        <div id="user-log" class="log"></div>
    </div>
    
    <div class="test-section">
        <h2>2. Selecionar Skin para Teste</h2>
        <p>Escolha uma skin para testar no jogo:</p>
        <div id="skin-selector"></div>
        <div id="skin-log" class="log"></div>
    </div>
    
    <div class="test-section">
        <h2>3. Verificar Dados no LocalStorage</h2>
        <p>Verificar se os dados estÃ£o sendo salvos corretamente:</p>
        <button onclick="checkLocalStorage()">Verificar Dados</button>
        <div id="storage-log" class="log"></div>
    </div>
    
    <div class="test-section">
        <h2>4. Testar no Jogo Real</h2>
        <p>Abrir o jogo com a skin configurada:</p>
        <a href="game.html" class="game-link" target="_blank">ðŸš€ Abrir Jogo</a>
        <a href="shop.html" class="game-link" target="_blank">ðŸ›’ Abrir Loja</a>
        <div id="game-instructions" class="log">InstruÃ§Ãµes:
1. Configure um usuÃ¡rio de teste
2. Selecione uma skin
3. Abra o jogo e verifique se a skin estÃ¡ aplicada
4. Observe o console do navegador para logs de depuraÃ§Ã£o</div>
    </div>
    
    <div class="test-section">
        <h2>5. Simular Sistema de Loja</h2>
        <p>Testar a funÃ§Ã£o useSkin diretamente:</p>
        <button onclick="testUseSkinFunction()">Testar useSkin</button>
        <div id="shop-log" class="log"></div>
    </div>

    <script>
        // Dados de teste
        const testUser = {
            id: 888,
            username: 'skin_tester',
            name: 'Testador de Skins',
            coins: 5000,
            high_score: 15000,
            created_at: new Date().toISOString()
        };
        
        const availableSkins = [
            { id: 'skin_milenium', name: 'Millennium Falcon', file: 'milenium.png', price: 500 },
            { id: 'skin_orange', name: 'Orange Fighter', file: 'orange.png', price: 300 },
            { id: 'skin_xwing', name: 'X-Wing', file: 'xwing.png', price: 800 },
            { id: 'skin_yellow', name: 'Yellow Wing', file: 'yellowwing.png', price: 400 }
        ];
        
        let selectedSkin = null;
        
        // Configurar usuÃ¡rio de teste
        window.setupGameUser = function() {
            const log = document.getElementById('user-log');
            log.textContent = 'ðŸ‘¤ Configurando usuÃ¡rio de teste...\n\n';
            
            try {
                // Salvar usuÃ¡rio atual
                localStorage.setItem('currentUser', JSON.stringify(testUser));
                log.textContent += 'âœ… UsuÃ¡rio salvo no localStorage\n';
                
                // Simular login
                localStorage.setItem('isLoggedIn', 'true');
                log.textContent += 'âœ… Status de login definido\n';
                
                // Simular inventÃ¡rio com todas as skins
                const inventory = availableSkins.map(skin => ({
                    itemId: skin.id,
                    itemType: 'skin',
                    quantity: 1,
                    purchasedAt: new Date().toISOString()
                }));
                
                localStorage.setItem(`inventory_${testUser.id}`, JSON.stringify(inventory));
                log.textContent += `âœ… InventÃ¡rio criado com ${inventory.length} skins\n`;
                
                log.textContent += '\nðŸŽ‰ UsuÃ¡rio de teste configurado com sucesso!';
                log.textContent += `\nðŸ“‹ ID: ${testUser.id}`;
                log.textContent += `\nðŸ“‹ Nome: ${testUser.name}`;
                log.textContent += `\nðŸ’° Moedas: ${testUser.coins}`;
                
                // Atualizar seletor de skins
                createSkinSelector();
                
            } catch (error) {
                log.textContent += `ðŸ’¥ Erro: ${error.message}\n`;
                console.error('Erro ao configurar usuÃ¡rio:', error);
            }
        };
        
        // Limpar usuÃ¡rio de teste
        window.clearGameUser = function() {
            const log = document.getElementById('user-log');
            log.textContent = 'ðŸ§¹ Limpando dados de teste...\n\n';
            
            try {
                localStorage.removeItem('currentUser');
                localStorage.removeItem('isLoggedIn');
                localStorage.removeItem(`inventory_${testUser.id}`);
                localStorage.removeItem(`selectedSkin_${testUser.id}`);
                localStorage.removeItem(`activeSkin_${testUser.id}`);
                
                // Limpar todas as possÃ­veis chaves relacionadas
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (key && key.includes(testUser.id.toString())) {
                        localStorage.removeItem(key);
                        i--; // Ajustar Ã­ndice apÃ³s remoÃ§Ã£o
                    }
                }
                
                log.textContent += 'âœ… Dados de teste removidos!';
                
                // Limpar seletor
                document.getElementById('skin-selector').innerHTML = '';
                selectedSkin = null;
                
            } catch (error) {
                log.textContent += `ðŸ’¥ Erro: ${error.message}\n`;
                console.error('Erro ao limpar dados:', error);
            }
        };
        
        // Criar seletor de skins
        function createSkinSelector() {
            const container = document.getElementById('skin-selector');
            container.innerHTML = '<h3>ðŸŽ¨ Escolha uma skin:</h3>';
            
            availableSkins.forEach(skin => {
                const skinDiv = document.createElement('div');
                skinDiv.className = 'skin-option';
                skinDiv.onclick = () => selectSkin(skin);
                
                skinDiv.innerHTML = `
                    <img src="src/assets/images/skins/${skin.file}" 
                         alt="${skin.name}" 
                         onerror="this.style.display='none'; this.nextElementSibling.style.display='block'">
                    <div style="display: none; font-size: 24px;">ðŸš€</div>
                    <div style="margin-top: 8px; font-size: 12px;">${skin.name}</div>
                    <div style="font-size: 10px; color: #888;">${skin.file}</div>
                `;
                
                container.appendChild(skinDiv);
            });
        }
        
        // Selecionar skin
        function selectSkin(skin) {
            const log = document.getElementById('skin-log');
            log.textContent = `ðŸŽ¨ Selecionando skin: ${skin.name}...\n\n`;
            
            try {
                // Remover seleÃ§Ã£o anterior
                document.querySelectorAll('.skin-option').forEach(el => {
                    el.classList.remove('selected');
                });
                
                // Marcar como selecionada
                event.currentTarget.classList.add('selected');
                selectedSkin = skin;
                
                // Salvar skin selecionada (formato do shop.js)
                const skinData = {
                    skinId: skin.id,
                    skinFile: skin.file,
                    skinName: skin.name,
                    selectedAt: new Date().toISOString()
                };
                
                localStorage.setItem(`selectedSkin_${testUser.id}`, JSON.stringify(skinData));
                log.textContent += 'âœ… Skin selecionada salva\n';
                
                // Salvar como skin ativa (formato do ShopClass)
                const activeSkinData = {
                    skinId: skin.id,
                    skinFile: skin.file,
                    setAt: new Date().toISOString()
                };
                
                localStorage.setItem(`activeSkin_${testUser.id}`, JSON.stringify(activeSkinData));
                log.textContent += 'âœ… Skin ativa definida\n';
                
                log.textContent += `\nðŸŽ‰ Skin ${skin.name} configurada!`;
                log.textContent += `\nðŸ“‹ ID: ${skin.id}`;
                log.textContent += `\nðŸ–¼ï¸ Arquivo: ${skin.file}`;
                
            } catch (error) {
                log.textContent += `ðŸ’¥ Erro: ${error.message}\n`;
                console.error('Erro ao selecionar skin:', error);
            }
        }
        
        // Verificar localStorage
        window.checkLocalStorage = function() {
            const log = document.getElementById('storage-log');
            log.textContent = 'ðŸ” Verificando dados no localStorage...\n\n';
            
            try {
                // Verificar usuÃ¡rio
                const currentUser = localStorage.getItem('currentUser');
                log.textContent += `ðŸ‘¤ currentUser: ${currentUser ? 'Encontrado' : 'NÃ£o encontrado'}\n`;
                
                if (currentUser) {
                    const userData = JSON.parse(currentUser);
                    log.textContent += `   Nome: ${userData.name}\n`;
                    log.textContent += `   ID: ${userData.id}\n`;
                }
                
                // Verificar skin selecionada
                const selectedSkinData = localStorage.getItem(`selectedSkin_${testUser.id}`);
                log.textContent += `\nðŸŽ¨ selectedSkin: ${selectedSkinData ? 'Encontrada' : 'NÃ£o encontrada'}\n`;
                
                if (selectedSkinData) {
                    const skinData = JSON.parse(selectedSkinData);
                    log.textContent += `   Skin: ${skinData.skinName}\n`;
                    log.textContent += `   Arquivo: ${skinData.skinFile}\n`;
                }
                
                // Verificar skin ativa
                const activeSkinData = localStorage.getItem(`activeSkin_${testUser.id}`);
                log.textContent += `\nðŸš€ activeSkin: ${activeSkinData ? 'Encontrada' : 'NÃ£o encontrada'}\n`;
                
                if (activeSkinData) {
                    const activeData = JSON.parse(activeSkinData);
                    log.textContent += `   Skin ID: ${activeData.skinId}\n`;
                    log.textContent += `   Arquivo: ${activeData.skinFile}\n`;
                }
                
                // Verificar inventÃ¡rio
                const inventory = localStorage.getItem(`inventory_${testUser.id}`);
                log.textContent += `\nðŸ“¦ inventory: ${inventory ? 'Encontrado' : 'NÃ£o encontrado'}\n`;
                
                if (inventory) {
                    const items = JSON.parse(inventory);
                    log.textContent += `   Itens: ${items.length}\n`;
                }
                
                // Verificar login
                const isLoggedIn = localStorage.getItem('isLoggedIn');
                log.textContent += `\nðŸ” isLoggedIn: ${isLoggedIn}\n`;
                
                log.textContent += '\nâœ… VerificaÃ§Ã£o concluÃ­da!';
                
            } catch (error) {
                log.textContent += `ðŸ’¥ Erro: ${error.message}\n`;
                console.error('Erro ao verificar localStorage:', error);
            }
        };
        
        // Testar funÃ§Ã£o useSkin
        window.testUseSkinFunction = function() {
            const log = document.getElementById('shop-log');
            log.textContent = 'ðŸ›’ Testando funÃ§Ã£o useSkin...\n\n';
            
            if (!selectedSkin) {
                log.textContent += 'âš ï¸ Nenhuma skin selecionada. Selecione uma skin primeiro.\n';
                return;
            }
            
            try {
                // Simular a funÃ§Ã£o useSkin do shop.js
                const currentUser = JSON.parse(localStorage.getItem('currentUser'));
                if (!currentUser) {
                    log.textContent += 'âŒ UsuÃ¡rio nÃ£o encontrado\n';
                    return;
                }
                
                log.textContent += `ðŸŽ¯ Aplicando skin ${selectedSkin.name}...\n`;
                
                // Salvar skin selecionada
                const skinData = {
                    skinId: selectedSkin.id,
                    skinFile: selectedSkin.file,
                    skinName: selectedSkin.name
                };
                
                localStorage.setItem(`selectedSkin_${currentUser.id}`, JSON.stringify(skinData));
                log.textContent += 'âœ… Skin salva no localStorage\n';
                
                // Simular aplicaÃ§Ã£o no player (se disponÃ­vel)
                if (window.player && typeof window.player.applySkin === 'function') {
                    const applied = window.player.applySkin(selectedSkin.id, selectedSkin.file);
                    log.textContent += `ðŸš€ AplicaÃ§Ã£o no Player: ${applied ? 'Sucesso' : 'Falhou'}\n`;
                } else {
                    log.textContent += 'âš ï¸ Player nÃ£o disponÃ­vel nesta pÃ¡gina\n';
                }
                
                log.textContent += '\nâœ… FunÃ§Ã£o useSkin simulada com sucesso!';
                log.textContent += '\nðŸ’¡ Abra o jogo para ver a skin aplicada.';
                
            } catch (error) {
                log.textContent += `ðŸ’¥ Erro: ${error.message}\n`;
                console.error('Erro ao testar useSkin:', error);
            }
        };
        
        // InicializaÃ§Ã£o
        document.addEventListener('DOMContentLoaded', () => {
            console.log('ðŸ§ª PÃ¡gina de teste de skins carregada');
            
            // Verificar se jÃ¡ existe um usuÃ¡rio
            const existingUser = localStorage.getItem('currentUser');
            if (existingUser) {
                createSkinSelector();
            }
        });
    </script>
</body>
</html>